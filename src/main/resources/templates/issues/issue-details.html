<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title th:text="'[' + ${issue.issueKey} + '] ' + ${issue.title} + ' | View issue |'"></title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <link href="/css/styles.css" rel="stylesheet" />
        <link href="https://unpkg.com/easymde/dist/easymde.min.css" rel="stylesheet" />
        <link rel="icon" type="image/x-icon" href="/assets/img/favicon.png" />
        <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js" crossorigin="anonymous"></script>
    </head>
    <body class="nav-fixed">
        <nav class="topnav navbar navbar-expand shadow justify-content-between justify-content-sm-start navbar-light bg-white" id="sidenavAccordion">
            <!-- Sidenav Toggle Button-->
            <button class="btn btn-icon btn-transparent-dark order-0 ms-2 me-0" id="sidebarToggle"><i data-feather="menu"></i></button>
            <!-- Navbar Brand-->
            <!-- * * Tip * * You can use text or an image for your navbar brand.-->
            <!-- * * * * * * When using an image, we recommend the SVG format.-->
            <!-- * * * * * * Dimensions: Maximum height: 32px, maximum width: 240px-->
            <a class="navbar-brand pe-3 ps-0 ps-lg-2" href="/dashboard">Issue Tracking System</a>
            <!-- Navbar Search Input-->
            <!-- * * Note: * * Visible only on and above the lg breakpoint-->
            <form class="form-inline me-auto d-none d-lg-block me-3">
                <div class="input-group input-group-joined input-group-solid">
                    <input class="form-control pe-0" type="search" placeholder="Search" aria-label="Search" />
                    <div class="input-group-text"><i data-feather="search"></i></div>
                </div>
            </form>
            <!-- Navbar Items-->
            <ul class="navbar-nav align-items-center ms-auto">
                <!-- Documentation Dropdown-->
                <li class="nav-item dropdown no-caret d-none d-md-block me-3">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownDocs" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="fw-500">Documentation</div>
                        <i class="fas fa-chevron-right dropdown-arrow"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end py-0 me-sm-n15 me-lg-0 o-hidden animated--fade-in-up" aria-labelledby="navbarDropdownDocs">
                        <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-admin-pro" target="_blank">
                            <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="book"></i></div>
                            <div>
                                <div class="small text-gray-500">Documentation</div>
                                Usage instructions and reference
                            </div>
                        </a>
                        <div class="dropdown-divider m-0"></div>
                        <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-admin-pro/components" target="_blank">
                            <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="code"></i></div>
                            <div>
                                <div class="small text-gray-500">Components</div>
                                Code snippets and reference
                            </div>
                        </a>
                        <div class="dropdown-divider m-0"></div>
                        <a class="dropdown-item py-3" href="https://docs.startbootstrap.com/sb-admin-pro/changelog" target="_blank">
                            <div class="icon-stack bg-primary-soft text-primary me-4"><i data-feather="file-text"></i></div>
                            <div>
                                <div class="small text-gray-500">Changelog</div>
                                Updates and changes
                            </div>
                        </a>
                    </div>
                </li>
                <!-- Navbar Search Dropdown-->
                <!-- * * Note: * * Visible only below the lg breakpoint-->
                <li class="nav-item dropdown no-caret me-3 d-lg-none">
                    <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="searchDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i data-feather="search"></i></a>
                    <!-- Dropdown - Search-->
                    <div class="dropdown-menu dropdown-menu-end p-3 shadow animated--fade-in-up" aria-labelledby="searchDropdown">
                        <form class="form-inline me-auto w-100">
                            <div class="input-group input-group-joined input-group-solid">
                                <input class="form-control pe-0" type="text" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2" />
                                <div class="input-group-text"><i data-feather="search"></i></div>
                            </div>
                        </form>
                    </div>
                </li>
                <!-- Alerts Dropdown-->
                <li class="nav-item dropdown no-caret d-none d-sm-block me-3 dropdown-notifications">
                    <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownAlerts" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i data-feather="bell"></i></a>
                    <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownAlerts">
                        <h6 class="dropdown-header dropdown-notifications-header">
                            <i class="me-2" data-feather="bell"></i>
                            Alerts Center
                        </h6>
                        <!-- Example Alert 1-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <div class="dropdown-notifications-item-icon bg-warning"><i data-feather="activity"></i></div>
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-details">December 29, 2021</div>
                                <div class="dropdown-notifications-item-content-text">This is an alert message. It's nothing serious, but it requires your attention.</div>
                            </div>
                        </a>
                        <!-- Example Alert 2-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <div class="dropdown-notifications-item-icon bg-info"><i data-feather="bar-chart"></i></div>
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-details">December 22, 2021</div>
                                <div class="dropdown-notifications-item-content-text">A new monthly report is ready. Click here to view!</div>
                            </div>
                        </a>
                        <!-- Example Alert 3-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <div class="dropdown-notifications-item-icon bg-danger"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-details">December 8, 2021</div>
                                <div class="dropdown-notifications-item-content-text">Critical system failure, systems shutting down.</div>
                            </div>
                        </a>
                        <!-- Example Alert 4-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <div class="dropdown-notifications-item-icon bg-success"><i data-feather="user-plus"></i></div>
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-details">December 2, 2021</div>
                                <div class="dropdown-notifications-item-content-text">New user request. Woody has requested access to the organization.</div>
                            </div>
                        </a>
                        <a class="dropdown-item dropdown-notifications-footer" href="#!">View All Alerts</a>
                    </div>
                </li>
                <!-- Messages Dropdown-->
                <li class="nav-item dropdown no-caret d-none d-sm-block me-3 dropdown-notifications">
                    <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownMessages" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i data-feather="mail"></i></a>
                    <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownMessages">
                        <h6 class="dropdown-header dropdown-notifications-header">
                            <i class="me-2" data-feather="mail"></i>
                            Message Center
                        </h6>
                        <!-- Example Message 1  -->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <img class="dropdown-notifications-item-img" src="/assets/img/illustrations/profiles/profile-2.png" />
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                                <div class="dropdown-notifications-item-content-details">Thomas Wilcox 路 58m</div>
                            </div>
                        </a>
                        <!-- Example Message 2-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <img class="dropdown-notifications-item-img" src="/assets/img/illustrations/profiles/profile-3.png" />
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                                <div class="dropdown-notifications-item-content-details">Emily Fowler 路 2d</div>
                            </div>
                        </a>
                        <!-- Example Message 3-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <img class="dropdown-notifications-item-img" src="/assets/img/illustrations/profiles/profile-4.png" />
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                                <div class="dropdown-notifications-item-content-details">Marshall Rosencrantz 路 3d</div>
                            </div>
                        </a>
                        <!-- Example Message 4-->
                        <a class="dropdown-item dropdown-notifications-item" href="#!">
                            <img class="dropdown-notifications-item-img" src="/assets/img/illustrations/profiles/profile-5.png" />
                            <div class="dropdown-notifications-item-content">
                                <div class="dropdown-notifications-item-content-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                                <div class="dropdown-notifications-item-content-details">Colby Newton 路 3d</div>
                            </div>
                        </a>
                        <!-- Footer Link-->
                        <a class="dropdown-item dropdown-notifications-footer" href="#!">Read All Messages</a>
                    </div>
                </li>
                <!-- User Dropdown-->
                <li class="nav-item dropdown no-caret dropdown-user me-3 me-lg-4">
                    <a class="btn btn-icon btn-transparent-dark dropdown-toggle" id="navbarDropdownUserImage" href="javascript:void(0);" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img th:if="${currentUser.hasProfilePicture()}" th:src="@{'/files/' +${currentUser.id} + '/true'}"
                             src="/assets/img/demo/user-placeholder.svg" class="img-fluid" alt="">
                        <img th:unless="${currentUser.hasProfilePicture()}" src="/assets/img/demo/user-placeholder.svg" class="img-fluid" alt="">
                    </a>                    <div class="dropdown-menu dropdown-menu-end border-0 shadow animated--fade-in-up" aria-labelledby="navbarDropdownUserImage">
                        <div class="h6 dropdown-header d-flex align-items-center">
                            <img th:if="${currentUser.hasProfilePicture()}" th:src="@{'/files/' +${currentUser.id} + '/true'}"
                                 src="/assets/img/demo/user-placeholder.svg" class="dropdown-user-img" alt="">
                            <img th:unless="${currentUser.hasProfilePicture()}" src="/assets/img/demo/user-placeholder.svg"
                                 class="dropdown-user-img" alt="">
                            <div class="dropdown-user-details">
                                <div th:text="${currentUser.firstName} + ' ' + ${currentUser.lastName}" class="dropdown-user-details-name"></div>
                                <div th:text="${currentUser.email}" class="dropdown-user-details-email"></div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" th:href="@{'/account/profile/' + ${currentUser.id}}">
                            <div class="dropdown-item-icon"><i data-feather="settings"></i></div>
                            Account
                        </a>
                        <form th:action="@{/logout}" name="logoutButton" method="post">
                            <a href="javascript: logoutButton.submit();" class="dropdown-item">
                                <div class="dropdown-item-icon"><i data-feather="log-out"></i></div>
                                Logout
                            </a>
                        </form>
                    </div>
                </li>
            </ul>
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sidenav shadow-right sidenav-light">
                    <div class="sidenav-menu">
                        <div class="nav accordion" id="accordionSidenav">
                            <!-- Sidenav Menu Heading (Account)-->
                            <!-- * * Note: * * Visible only on and above the sm breakpoint-->
                            <div class="sidenav-menu-heading d-sm-none">Account</div>
                            <!-- Sidenav Link (Alerts)-->
                            <!-- * * Note: * * Visible only on and above the sm breakpoint-->
                            <a class="nav-link d-sm-none" href="#!">
                                <div class="nav-link-icon"><i data-feather="bell"></i></div>
                                Alerts
                                <span class="badge bg-warning-soft text-warning ms-auto">4 New!</span>
                            </a>
                            <!-- Sidenav Link (Messages)-->
                            <!-- * * Note: * * Visible only on and above the sm breakpoint-->
                            <a class="nav-link d-sm-none" href="#!">
                                <div class="nav-link-icon"><i data-feather="mail"></i></div>
                                Messages
                                <span class="badge bg-success-soft text-success ms-auto">2 New!</span>
                            </a>

                            <!-- START OF THE NORMAL SIDENAV -->
                            <!-- Sidenav Link (Dashboard)-->
                            <a class="nav-link" href="/dashboard">
                                <div class="nav-link-icon"><i data-feather="activity"></i></div>
                                Dashboard
                            </a>
                            <!-- Sidenav Link (Add Issue)-->
                            <div th:if="${currentUser.getRole().name == 'Project Manager' ||
                                        currentUser.getRole().name == 'Admin' || currentUser.getRole().name == 'Developer'}">
                                <a class="nav-link collapsed" href="javascript:void(0);" data-bs-toggle="collapse"
                                   data-bs-target="#collapseAddIssue" aria-expanded="false" aria-controls="collapseAddIssue">
                                    <div class="nav-link-icon"><i data-feather="plus"></i></div>
                                    Add Issue
                                    <div class="sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                </a>
                                <div class="collapse" id="collapseAddIssue" data-bs-parent="#accordionSidenav">
                                    <nav class="sidenav-menu-nested nav accordion" id="accordionSidenavAddIssue">
                                        <a class="nav-link" th:href="@{'/issues/' + ${project.identifier} +'/new'}"
                                           th:each="project : ${currentUserProjects}" th:value="${project.id}" th:text="${project.name}">
                                        </a>
                                    </nav>
                                </div>
                            </div>

                            <!-- Sidenav Link (Issues List)-->
                            <a class="nav-link active" href="javascript:void(0);" data-bs-toggle="collapse"
                               data-bs-target="#collapseIssues" aria-expanded="false" aria-controls="collapseIssues">
                                <div class="nav-link-icon"><i data-feather="list"></i></div>
                                Issues
                                <div class="sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                            </a>
                            <div class="collapse show" id="collapseIssues" data-bs-parent="#accordionSidenav">
                                <a class="nav-link" th:href="@{'/issues/all'}">All Issues</a>
                                <nav class="sidenav-menu-nested nav accordion" id="accordionSidenavIssues">
                                    <a class="nav-link" th:each="project : ${currentUserProjects}" th:classappend="${project.id==currentProject.id} ? active" th:href="@{'/issues/' + ${project.identifier}}" th:value="${project.id}" th:text="${project.name}"></a>
                                </nav>
                            </div>
                            <!-- Sidenav Link (Organization)-->
                            <a class="nav-link" href="/organization">
                                <div class="nav-link-icon"><i data-feather="globe"></i></div>
                                Organization
                            </a>
                            <!-- Sidenav Link (Projects)-->
                            <a class="nav-link collapsed" href="javascript:void(0);" data-bs-toggle="collapse"
                               data-bs-target="#collapseProjects" aria-expanded="false" aria-controls="collapseProjects">
                                <div class="nav-link-icon"><i data-feather="grid"></i></div>
                                Projects
                                <div class="sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                            </a>
                            <div class="collapse" id="collapseProjects" data-bs-parent="#accordionSidenav">
                                <a class="nav-link" th:href="@{'/projects/all'}">All Projects</a>
                                <nav class="sidenav-menu-nested nav accordion" id="accordionSidenavProjects">
                                    <a class="nav-link" th:href="@{'/projects/' + ${project.identifier}}" th:each="project : ${currentUserProjects}" th:value="${project.id}" th:text="${project.name}"></a>
                                </nav>
                            </div>
                            <!-- Sidenav Link (Users)-->
                            <a class="nav-link" href="/users">
                                <div class="nav-link-icon"><i data-feather="users"></i></div>
                                Users
                            </a>
                            <!-- Sidenav Link (Account) -->
                            <a class="nav-link" th:href="@{'/account/profile/' + ${currentUser.id}}">
                                <div class="nav-link-icon"><i data-feather="settings"></i></div>
                                Account
                            </a>

                        </div>
                    </div>
                    <!-- Sidenav Footer-->
                    <div class="sidenav-footer">
                        <div class="sidenav-footer-content">
                            <div class="sidenav-footer-subtitle">Logged in as:</div>
                            <div th:text="${currentUser.firstName} + ' ' + ${currentUser.lastName}" class="sidenav-footer-title"></div>
                        </div>
                    </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <header class="page-header page-header-compact page-header-light border-bottom bg-white mb-4">
                        <div class="container-fluid px-4">
                            <div class="page-header-content">
                                <div class="row align-items-center justify-content-between pt-3">
                                    <div class="col-auto mb-3">
                                        <h1 class="page-header-title">
                                            <div class="page-header-icon"><i data-feather="file"></i></div>
                                            Issue Details
                                        </h1>
                                    </div>

                                    <div class="col-12 col-xl-auto mb-3">
                                        <a class="btn btn-sm btn-light text-primary" href="/issues/all">
                                            <i class="me-1" data-feather="arrow-left"></i>
                                            Back to All Issues
                                        </a>
                                        <a th:if="${currentUser.getRole().name == 'Project Manager' || currentUser.getRole().name == 'Admin' || currentUser.getRole().name == 'Developer'}"
                                           th:href="@{'/issues/' + ${currentProject.identifier} +'/new'}" class="btn btn-sm btn-light text-primary">
                                            <i class="me-1" data-feather="plus"></i>
                                            Create New Issue
                                        </a>
                                        <a th:if="${issue.user == currentUser || currentUser.role.name == 'Project Manager' || currentUser.role.name == 'Admin'}"
                                           th:href="@{'/issues/' + ${currentProject.identifier} + '/edit/' + ${issue.issueKey}}"
                                           class="btn btn-sm btn-light text-primary">
                                            <i class="me-1" data-feather="edit"></i>
                                            Edit Issue
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </header>
                    <!-- Main page content -->
                    <div class="container-fluid px-4 mt-4">
                        <div class="card mb-4">
                            <div th:text="'[' + ${issue.issueKey} + '] ' + ${issue.title}" class="card-header"></div>

                            <label for="descriptionViewer"></label>
                            <textarea th:text="${issue.description}" id="descriptionViewer" hidden></textarea>
                            <!-- THIS CONVERTS THE DESCRIPTION TO MARKDOWN FORMAT -->
                            <div id="targetDiv" class="card-body mt-3 mb-1"></div>

                            <hr class="ms-auto me-auto mb-3" style="width: 98%;">

                            <ul class="row mb-2">
                                <li class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                        <div class="fw-bold mb-2">Opened By</div>
                                        <span th:text="${issue.user.firstName} + ' ' + ${issue.user.lastName}"></span>
                                    </div>
                                </li>
                                <li class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                        <div class="fw-bold mb-2">Assigned To</div>
                                        <span th:text="${issue.assignedTo.firstName} + ' ' + ${issue.assignedTo.lastName}"
                                              th:if="${issue ne null and issue.assignedTo ne null}">
                                        </span>
                                    </div>
                                </li>
                            </ul>

                            <hr class="ms-auto me-auto mt-1" style="width: 95%;">

                            <ul class="row mb-2">
                                <li class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Project</div>
                                        <span th:text="${issue.project.name}"></span>
                                    </div>
                                </li>
                                <li th:switch="${issue.type}" class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Type</div>
                                        <h5>
                                            <span class="badge bg-red-soft text-red" th:case="Bug">Bug</span>
                                            <span class="badge bg-purple-soft text-purple" th:case="Task">Task</span>
                                            <span class="badge bg-green-soft text-green" th:case="Request">Request</span>
                                            <span class="badge bg-gray-200 text-dark" th:case="Other">Other</span>
                                        </h5>
                                    </div>
                                </li>
                            </ul>

                            <hr class="ms-auto me-auto mt-1" style="width: 95%;">

                            <ul class="row mb-2">
                                <li th:switch="${issue.priority}" class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Priority</div>
                                        <h5>
                                            <span th:case="Low" class="badge bg-green-soft text-green">Low</span>
                                            <span th:case="Normal"
                                                  class="badge bg-yellow-soft text-yellow">Normal</span>
                                            <span th:case="High" class="badge bg-red-soft text-red">High</span>
                                        </h5>
                                    </div>
                                </li>
                                <li th:switch="${issue.status}" class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Status</div>
                                        <h5>
                                            <span th:case="Open" class="badge bg-red-soft text-red">Open</span>
                                            <span th:case="In-Progress"
                                                  class="badge bg-blue-soft text-blue">In Progress</span>
                                            <span th:case="Resolved" class="badge bg-green-soft text-green">Resolved</span>
                                            <span th:case="Closed" class="badge bg-yellow-soft text-yellow">Closed</span>
                                        </h5>
                                    </div>
                                </li>

                            </ul>

                            <hr class="ms-auto me-auto mt-1" style="width: 95%;">

                            <ul class="row mb-4">
                                <li class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Created</div>
                                        <span th:text="${#temporals.format(issue.dateCreated, 'dd MMM yyyy HH:mm:ss')}"></span>
                                    </div>
                                </li>

                                <li class="col d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                    <div class="fw-bold mb-2">Updated</div>
                                        <span th:text="${#temporals.format(issue.dateUpdated, 'dd MMM yyyy HH:mm:ss')}"></span>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- List of the Attachments -->
                        <div th:if="${!attachments.isEmpty()}" class="card mb-4">
                            <label for="attachments" class="card-header">Attachments (<span th:text="${attachments.size()}"></span>)</label>
                            <div class="card-body">
                                <div th:each="attachment : ${attachments}">
                                    <span th:switch="${attachment.type}">
                                        <i th:case="'application/vnd.openxmlformats-officedocument.presentationml.presentation'" class="me-1 mt-1" data-feather="file-text"></i>
                                        <i th:case="'application/vnd.openxmlformats-officedocument.wordprocessingml.document'" class="me-1 mt-1" data-feather="file-text"></i>
                                        <i th:case="'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'" class="me-1 mt-1" data-feather="file-text"></i>
                                        <i th:case="'application/pdf'" class="me-1 mt-1" data-feather="file-text"></i>
                                        <i th:case="'text/plain'" class="me-1 mt-1" data-feather="file-text"></i>
                                        <i th:case="'image/jpeg'" class="me-1 mt-1" data-feather="image"></i>
                                        <i th:case="*" class="me-1 mt-1" data-feather="file"></i>
                                    </span>
                                    <a th:href="@{'/files/' + ${attachment.id}}" th:text="${attachment.name}" id="attachments"></a>
                                    <span th:if="${attachment.size < 1000000}" th:text="'(' + ${attachment.size / 1000} + ' KB, ' + ${#temporals.format(attachment.dateCreated, 'dd MMM yyyy HH:mm:ss')} + ')'" style="font-size: 12px;"></span>
                                    <span th:if="${attachment.size > 999999}" th:text="'(' + ${#numbers.formatDecimal((attachment.size * 1.0) / 1000000, 1, 1)} + ' MB, ' + ${#temporals.format(attachment.dateCreated, 'dd MMM yyyy HH:mm:ss')} + ')'" style="font-size: 12px;"></span>
                                    <a class="btn-transparent-dark"
                                       th:href="@{'/files/' + ${currentProject.identifier} + '/' + ${issue.issueKey} + '/delete/' + ${attachment.id}}"
                                       th:attr="onclick=|return confirm('Are you sure you want to delete &quot;${attachment.name}&quot;?')|">
                                        <i data-feather="trash-2" class="mt-1"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- LIST OF THE COMMENTS -->
                        <div th:if="${!issue.getComments().isEmpty()}" class="card mb-4">
                            <!-- BE ABLE TO SHOW THE CORRECT NUMBER OF COMMENTS -->
                            <div class="card-header">Comments (<span th:text="${issue.getComments().size()}"></span>)</div>
                            <div class="card-body ms-n3">
                                <!-- THE "list" IS TO GAIN ACCESS TO THE "comments" array's: "size," "count," "last," etc. -->
                                <ul th:each="comment, list : ${comments}" class="row">
                                    <li class="col d-flex">
                                        <div class="me-auto">
                                            <div th:text="${comment.user.firstName} + ' ' + ${comment.user.lastName}" class="fw-bold mb-n2"></div>
                                                <div th:if="${comment.user==currentUser}" style="position: absolute; left: 91.5%;">
                                                    <a th:id="'editCommentButton' + ${list.index}" onclick="editComment(this)" class="btn-lg btn-icon btn-transparent-dark me-2 editCommentButton" href="javascript:void(0);"><i data-feather="edit"></i></a>
                                                    <a class="btn-lg btn-icon btn-transparent-dark"
                                                       th:href="@{'/issues/' + ${currentProject.identifier} + '/view/' + ${issue.issueKey} + '/comment/' + ${comment.id} + '/delete'}"
                                                       onclick="return confirm('Are you sure you want to delete this comment?');">
                                                        <i data-feather="trash-2"></i>
                                                    </a>
                                                </div>
                                            <span th:text="${#temporals.format(comment.dateCreated, 'dd MMM yyyy HH:mm:ss')}" style="font-size: 12px;"></span>
                                        </div>
                                    </li>

                                    <!-- THIS IS TO ADD SEPARATION BETWEEN dateCreated and message -->
                                    <p></p>

                                    <li class="mt-n1" style="list-style-type: none;">
                                        <form action="#" th:action="@{'/issues/' + ${currentProject.identifier} + '/view/' + ${issue.issueKey} + '/comment/save'}" th:object="${comment}" method="post">
                                            <label for="id" hidden><input th:value="${comment.id}" th:name="id" readonly="readonly" id="id"></label>
                                            <label for="user" hidden><input th:value="${comment.user.id}" th:name="user" readonly="readonly" id="user"></label>
                                            <label for="issue" hidden><input th:value="${comment.issue.id}" th:name="issue" readonly="readonly" id="issue"></label>
                                            <label hidden for="isEdited"><input th:value="${comment.isEdited}" th:name="isEdited" readonly="readonly" id="isEdited" class="isEdited"></label>
                                            <label for="markdownEditCommentEditor" hidden></label>
                                            <textarea th:text="${comment.message}" th:value="${comment.message}" th:name="message" id="markdownEditCommentEditor" class="comments" style="display: none;"></textarea>
                                            <button th:id="'editCommentButton' + ${list.index}" onclick="editComment(this)" type="button" class="cancelEditCommentButton btn btn-outline-primary btn-sm me-2 mt-n5" hidden>Cancel</button>
                                            <button type="submit" class="submitEditCommentButton btn btn-primary btn-sm mt-n5" hidden>Submit</button>
                                            <!-- THIS CONVERTS THE COMMENTS TO MARKDOWN FORMAT -->
                                            <div class="markdownFormattedComment"></div>
                                        </form>
                                    </li>

                                    <!-- THIS IS TO STOP PRINTING THE HORIZONTAL LINE AFTER THE LAST COMMENT -->
                                    <div th:if="${!list.last}">
                                        <hr class="ms-n2 me-1 mt-6 mb-2">
                                    </div>

                                </ul>

                            </div>
                        </div>

                        <!-- List of the Issue's Change History -->
                        <div th:if="${!issueChangeHistoryList.isEmpty()}" class="card mb-4">
                            <div class="card-header">Change History</div>
                            <div class="card-body">
                                <table id="datatablesSimple" class="table table-hover" style="font-size: 12px">
                                    <thead>
                                    <tr>
                                        <th class="align-middle text-center text-nowrap">Updated By</th>
                                        <th class="align-middle text-center text-nowrap">Property</th>
                                        <th class="align-middle text-center text-nowrap">Old Value</th>
                                        <th class="align-middle text-center text-nowrap">New Value</th>
                                        <th class="align-middle text-center text-nowrap">Date Changed</th>
                                    </tr>
                                    </thead>
                                    <tfoot>
                                    <tr>
                                        <th>Updated By</th>
                                        <th>Property</th>
                                        <th>Old Value</th>
                                        <th>New Value</th>
                                        <th>Date Changed</th>
                                    </tr>
                                    </tfoot>
                                    <tbody>
                                    <tr th:each="version : ${issueChangeHistoryList}">
                                        <!-- UPDATED BY -->
                                        <td th:text="${version.updatedBy.firstName} + ' ' + ${version.updatedBy.lastName}" class="text-nowrap"></td>

                                        <!-- PROPERTY -->
                                        <td th:text="${version.property}" class="text-nowrap"></td>

                                        <!-- OLD VALUE -->
                                        <td th:if="${version.property == 'Status'}">
                                            <span th:switch="${version.oldValue}">
                                                <span th:case="Open" th:text="${version.oldValue}" class="badge bg-red-soft text-red"></span>
                                                <span th:case="In-Progress" th:text="${version.oldValue}" class="badge bg-blue-soft text-blue"></span>
                                                <span th:case="Resolved" th:text="${version.oldValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Closed" th:text="${version.oldValue}" class="badge bg-yellow-soft text-yellow"></span>
                                            </span>
                                        </td>
                                        <td th:if="${version.property == 'Type'}">
                                            <span th:switch="${version.oldValue}">
                                                <span th:case="Bug" th:text="${version.oldValue}" class="badge bg-red-soft text-red"></span>
                                                <span th:case="Task" th:text="${version.oldValue}" class="badge bg-purple-soft text-purple"></span>
                                                <span th:case="Request" th:text="${version.oldValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Other" th:text="${version.oldValue}" class="badge bg-gray-200 text-dark"></span>
                                            </span>
                                        </td>
                                        <td th:if="${version.property == 'Priority'}">
                                            <span th:switch="${version.oldValue}">
                                                <span th:case="Low" th:text="${version.oldValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Normal" th:text="${version.oldValue}" class="badge bg-yellow-soft text-yellow"></span>
                                                <span th:case="High" th:text="${version.oldValue}" class="badge bg-red-soft text-red"></span>
                                            </span>
                                        </td>

                                        <label for="changeHistoryOldDescription">
                                            <textarea th:if="${version.property == 'Description'}" th:text="${version.oldValue}" id="changeHistoryOldDescription" class="changeHistoryDescriptions" hidden></textarea>
                                        </label>
                                        <td th:if="${version.property == 'Description'}" class="markdownFormattedChangeHistoryDescriptions"></td>
                                        <td th:unless="${version.property == 'Type' || version.property == 'Priority' || version.property == 'Status' || version.property == 'Description'}" th:text="${version.oldValue}" id="targetTd"></td>

                                        <!-- NEW VALUE -->
                                        <td th:if="${version.property == 'Status'}">
                                            <span th:switch="${version.newValue}">
                                                <span th:case="Open" th:text="${version.newValue}" class="badge bg-red-soft text-red"></span>
                                                <span th:case="In-Progress" th:text="${version.newValue}" class="badge bg-blue-soft text-blue"></span>
                                                <span th:case="Resolved" th:text="${version.newValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Closed" th:text="${version.newValue}" class="badge bg-yellow-soft text-yellow"></span>
                                            </span>
                                        </td>
                                        <td th:if="${version.property == 'Type'}">
                                            <span th:switch="${version.newValue}">
                                                <span th:case="Bug" th:text="${version.newValue}" class="badge bg-red-soft text-red"></span>
                                                <span th:case="Task" th:text="${version.newValue}" class="badge bg-purple-soft text-purple"></span>
                                                <span th:case="Request" th:text="${version.newValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Other" th:text="${version.newValue}" class="badge bg-gray-200 text-dark"></span>
                                            </span>
                                        </td>
                                        <td th:if="${version.property == 'Priority'}">
                                            <span th:switch="${version.newValue}">
                                                <span th:case="Low" th:text="${version.newValue}" class="badge bg-green-soft text-green"></span>
                                                <span th:case="Normal" th:text="${version.newValue}" class="badge bg-yellow-soft text-yellow"></span>
                                                <span th:case="High" th:text="${version.newValue}" class="badge bg-red-soft text-red"></span>
                                            </span>
                                        </td>

                                        <label for="changeHistoryNewDescription">
                                            <textarea th:if="${version.property == 'Description'}" th:text="${version.newValue}" id="changeHistoryNewDescription" class="changeHistoryDescriptions" hidden></textarea>
                                        </label>
                                        <td th:if="${version.property == 'Description'}" class="markdownFormattedChangeHistoryDescriptions"></td>

                                        <td th:unless="${version.property == 'Type' || version.property == 'Priority' || version.property == 'Status' || version.property == 'Description'}" th:text="${version.newValue}"></td>

                                        <!-- DATE CHANGED -->
                                        <td th:text="${#temporals.format(version.changeVersion.requiredRevisionInstant, 'dd MMM yyyy HH:mm:ss')}" class="text-nowrap"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ADD A COMMENT SECTION -->
                        <form action="#" th:action="@{'/issues/' + ${currentProject.identifier} + '/view/' + ${issue.issueKey} + '/comment/new'}" th:object="${newComment}" id="addComment" method="post"></form>
                        <div class="card">
                            <div class="card-header">Add Comment</div>
                            <div class="card-body mt-n3">
                                <label for="markdownCommentEditor"></label>
                                <textarea th:field="*{newComment.message}" id="markdownCommentEditor" form="addComment" class="form-control" placeholder="Write a comment..."></textarea>
                                <button type="submit" class="btn btn-primary btn me-2 mt-n4" form="addComment">Add Comment</button>
                                <button class="btn btn-light btn me-2 mt-n4" data-bs-toggle="modal" data-bs-target="#attachFileModal">
                                    <i class="fas fa-paperclip me-2"></i>
                                    Attach File(s)
                                </button>
                                <button onclick="markIssueAsResolved()" class="btn btn-light btn mt-n4" type="submit" form="updateIssue"
                                        th:if="${currentUser == issue.user || currentUser.role.name == 'Project Manager' || currentUser.role.name == 'Admin'}">
                                    <i class="fas fa-check-circle me-2"></i>
                                    Mark as Resolved
                                </button>
                                <button onclick="markIssueAsClosed()" class="btn btn-light btn mt-n4" type="submit" form="updateIssue"
                                        th:if="${currentUser.role.name == 'Project Manager' || currentUser.role.name == 'Admin'}">
                                    <i class="me-2" data-feather="x-circle"></i>
                                    Mark as Closed
                                </button>

                                <!-- Attach File(s) Modal -->
                                <div class="modal fade" id="attachFileModal" tabindex="-1" role="dialog" aria-labelledby="attachFileModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="attachFileModalLabel">Attach File(s)</h5>
                                                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="mb-0">
                                                    <form action="#" th:action="@{/issues/update}" th:object="${issue}" method="post"
                                                          enctype="multipart/form-data">
                                                        <label class="mb-1 small text-muted" for="files" hidden></label>
                                                        <div class="d-flex">
                                                            <input th:name="files" class="form-control" id="files" type="file" multiple/>
                                                            <label hidden>
                                                                <input th:field="*{id}" readonly>
                                                            </label>
                                                            <label for="isAttachFileForm" hidden>
                                                                <input th:name="isAttachFileForm" id="isAttachFileForm" value="true" readonly>
                                                            </label>
                                                            <button class="btn btn-primary ms-2" type="submit">Upload</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- THIS CHANGES THE ISSUE STATUS TO: RESOLVED -->
                                <form action="#" th:action="@{/issues/update}" th:object="${issue}" id="updateIssue" method="post">
                                    <span hidden th:if="${currentUser == issue.user || currentUser.role.name == 'Project Manager' || currentUser.role.name == 'Admin'}">
                                        <label for="issueId"><input th:field="*{id}" id="issueId" form="updateIssue" readonly/></label>
                                        <label for="issueKey"><input th:field="*{issueKey}" id="issueKey" type="text" readonly></label>
                                        <label for="issueTitle"><input th:field="*{title}" id="issueTitle" type="text" readonly/></label>
                                        <label for="issueDescription"><input th:field="*{description}" id="issueDescription" type="text" readonly/></label>
                                        <label for="issueAssignedTo"><input th:field="*{assignedTo}" id="issueAssignedTo" type="text" readonly/></label>
                                        <label for="issueType"><input th:field="*{type}" id="issueType" type="text" readonly/></label>
                                        <label for="issuePriority"><input th:field="*{priority}" id="issuePriority" type="text" readonly/></label>

                                        <label for="markIssueAsResolvedOrClosed">
                                            <select th:field="*{status}" id="markIssueAsResolvedOrClosed">
                                                <option value="Resolved">Resolved</option>
                                                <option value="Closed">Closed</option>
                                            </select>
                                        </label>
                                        <label for="issueProject"><input th:value="${issue.project.id}" id="issueProject" name="project" form="updateIssue" readonly/></label>
                                    </span>
                                </form>
                            </div>
                        </div>
                    </div>
                </main>
                <footer class="footer-admin mt-auto footer-light">
                    <div class="container-xl px-4">
                        <div class="row">
                            <div class="col-md-6 small">Copyright &copy; Your Website 2021</div>
                            <div class="col-md-6 text-md-end small">
                                <a href="#!">Privacy Policy</a>
                                &middot;
                                <a href="#!">Terms &amp; Conditions</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="/js/scripts.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
        <script src="/js/datatables/datatables-simple-demo.js"></script>
        <script src="https://unpkg.com/easymde/dist/easymde.min.js" crossorigin="anonymous"></script>
<!--        <script src="https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js" crossorigin="anonymous"></script>-->
        <script src="/js/markdown.js"></script>
        <script src="/js/showdown.min.js"></script>

        <script>
            // this sets each Edit Comment Editor to have a unique ID to be used to show/hide itself
            for(let i=0; i < document.getElementsByClassName("EasyMDEContainer").length - 1; i++) {
                document.getElementsByClassName("EasyMDEContainer").item(i).setAttribute("id", "editCommentEditor" + i);
                document.getElementsByClassName("EasyMDEContainer").item(i).setAttribute("style", "display: none;");
            }

            // this hides the Markdown formatted Comment Message and replaces it with a Markdown Editor to Edit a Comment
            function editComment(commentId) {
                let commentIndex = commentId.id.replace("editCommentButton", "");

                if(document.getElementsByClassName("EasyMDEContainer").item(commentIndex).getAttribute("style") === "display: none;") {
                    document.getElementsByClassName("markdownFormattedComment").item(commentIndex).setAttribute("style", "display: none;");

                    document.getElementsByClassName("EasyMDEContainer").item(commentIndex).setAttribute("style", "display: block;");
                    document.getElementsByClassName("cancelEditCommentButton").item(commentIndex).removeAttribute("hidden");
                    document.getElementsByClassName("submitEditCommentButton").item(commentIndex).removeAttribute("hidden");
                } else {
                    document.getElementsByClassName("EasyMDEContainer").item(commentIndex).setAttribute("style", "display: none;");
                    document.getElementsByClassName("cancelEditCommentButton").item(commentIndex).setAttribute("hidden", "");
                    document.getElementsByClassName("submitEditCommentButton").item(commentIndex).setAttribute("hidden", "");

                    document.getElementsByClassName("markdownFormattedComment").item(commentIndex).setAttribute("style", "display: block;");
                }
            }

            // Markdown Formatted Issue Description
            let converter1 = new showdown.Converter(),
                text1 = document.getElementById("descriptionViewer").value,
                target1 = document.getElementById("targetDiv");
            showdown.setOption('optionKey', 'value');

            target1.innerHTML = converter1.makeHtml(text1);

            // Markdown Formatted Issue Descriptions in Change History Card
            let converter2 = new showdown.Converter();
            for(let i=0; i < document.getElementsByClassName("changeHistoryDescriptions").length; i++) {
                let text2 = document.getElementsByClassName("changeHistoryDescriptions").item(i).value,
                target2 = document.getElementsByClassName("markdownFormattedChangeHistoryDescriptions").item(i);
            showdown.setOption('optionKey', 'value');

            target2.innerHTML = converter2.makeHtml(text2);
            }


            // Markdown Formatted Comments
            let converter3 = new showdown.Converter();
            for(let i=0; i < document.getElementsByClassName("comments").length; i++) {
                let text3 = document.getElementsByClassName("comments").item(i).value,
                    target3 = document.getElementsByClassName("markdownFormattedComment").item(i);

                // An HTML Span to be appended if a comment has been edited
                let editedSpan = document.createElement('span');
                editedSpan.innerHTML = " (Edited)";
                editedSpan.setAttribute("style", "font-size: 11px;");
                editedSpan.setAttribute("class", "text-muted fst-italic");

                // converts to Markdown format
                target3.innerHTML = converter3.makeHtml(text3);

                // checks if a comment has been edited and appends the Span accordingly
                let isEdited = document.getElementsByClassName("isEdited").item(i).value;
                if(isEdited === "true") {
                    target3.lastChild.appendChild(editedSpan);
                }
            }

            function markIssueAsResolved() {
                let markIssueOptions = document.getElementById('markIssueAsResolvedOrClosed');
                markIssueOptions.selectedIndex = 0;
            }
            function markIssueAsClosed() {
                let markIssueOptions = document.getElementById('markIssueAsResolvedOrClosed');
                markIssueOptions.selectedIndex = 1;
            }
        </script>
    </body>
</html>
